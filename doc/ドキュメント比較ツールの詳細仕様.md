# ドキュメント比較ツールの詳細仕様

## 1. 文字列検索ツール

- **機能**: 指定された語句で文字列検索した結果を取得する
- **前提条件**: 対象ドキュメントは事前に格納済み
- **入力パラメータ**:
  - `pattern`: 検索パターン（文字列または正規表現）
  - `document_id`: 検索対象ドキュメントのID
  - `use_regex`: 正規表現を使用するかどうかのフラグ（デフォルト: false）
  - `case_sensitive`: 大文字小文字を区別するかどうかのフラグ（デフォルト: false）
- **出力**:
  - マッチしたチャンクのリスト（各チャンクにはID、内容、マッチ位置情報を含む）

## 2. ベクトル類似度検索ツール

- **機能**: 指定された語句・文章とベクトル類似度が高いチャンクを取得する
- **前提条件**: 検索対象ドキュメントは既にベクトル化して保持
- **入力パラメータ**:
  - `query_text`: クエリテキスト
  - `document_id`: 検索対象ドキュメントのID
  - `threshold`: 類似度閾値（デフォルト: 0.7）
  - `max_results`: 最大結果数（デフォルト: 5）
- **出力**:
  - 類似度スコア付きのチャンクリスト（降順）

## 3. 比較元チャンクの文脈取得ツール

- **機能**: 指定されたチャンクが含まれる上位階層の要約を含む文脈情報を取得する
- **前提条件**: 比較元文書は事前に格納済み
- **入力パラメータ**:
  - `chunk_id`: チャンクID
  - `include_hierarchy`: 上位階層の要約を含めるかどうかのフラグ（デフォルト: true）
  - `hierarchy_levels`: 取得する階層レベル数（デフォルト: 1）
- **出力**:
  - チャンクの詳細情報（ID、内容、メタデータ）
  - 上位階層の要約情報（階層レベル、要約内容）

## 4. 比較先チャンクの文脈取得ツール

- **機能**: 指定されたチャンクが含まれる上位階層の要約を含む文脈情報を取得する
- **前提条件**: 比較先文書は事前に格納済み
- **入力パラメータ**:
  - `chunk_id`: チャンクID
  - `include_hierarchy`: 上位階層の要約を含めるかどうかのフラグ（デフォルト: true）
  - `hierarchy_levels`: 取得する階層レベル数（デフォルト: 1）
- **出力**:
  - チャンクの詳細情報（ID、内容、メタデータ）
  - 上位階層の要約情報（階層レベル、要約内容）

## 5. 前後チャンク取得ツール

- **機能**: 特定のチャンクの前、または後に続くチャンクを指定された数だけ取得
- **前提条件**: ドキュメントは事前に格納済み
- **入力パラメータ**:
  - `chunk_id`: チャンクID
  - `document_id`: ドキュメントID
  - `direction`: 取得方向（"prev"または"next"）
  - `count`: 取得数（デフォルト: 1）
- **出力**:
  - 指定された数の前後チャンクリスト（各チャンクにはID、内容、メタデータを含む）

## 6. システムプロンプトへの反映

以下のようなシステムプロンプトでLLMにツールの詳細を伝えることで、より効果的な比較分析が可能になります：

```
あなたは2つのドキュメントを比較するアシスタントです。
現在、ドキュメントAのチャンクを処理しています。
ドキュメントBから対応するチャンクを見つけ、追加・削除・変更を特定してください。

以下のツールが利用可能です：

1. 文字列検索ツール (string_search_tool)
   - 機能: 指定された語句で文字列検索した結果を取得する
   - 正規表現での検索も可能
   - 使用例: 重要なキーワードや固有名詞を検索する場合

2. ベクトル類似度検索ツール (vector_similarity_tool)
   - 機能: 指定された語句・文章とベクトル類似度が高いチャンクを取得する
   - 既にベクトル化されたドキュメントから意味的に類似したチャンクを検索
   - 使用例: 表現は異なるが意味的に類似した内容を検索する場合

3. 比較元チャンクの文脈取得ツール (get_context_tool_a)
   - 機能: 指定されたチャンクが含まれる上位階層の要約を返却
   - 使用例: 現在のチャンクの文脈をより深く理解したい場合

4. 比較先チャンクの文脈取得ツール (get_context_tool_b)
   - 機能: 指定されたチャンクが含まれる上位階層の要約を返却
   - 使用例: 比較対象チャンクの文脈をより深く理解したい場合

5. 前後チャンク取得ツール (get_adjacent_chunks_tool)
   - 機能: 特定のチャンクの前、または後に続くチャンクを指定された数だけ取得
   - 使用例: チャンクの前後関係を確認したい場合

現在のチャンク情報と、これまでの比較結果を考慮して、最適なツールを選択し実行してください。
ツールを使用する必要がなければ、最終的な比較結果を提供してください。
```
